<!-- This file is generated by AI (gemini-3-pro), code-style and boilerplate reflects that... -->
<!DOCTYPE html>
<html>
<head>
    <title>Parking Data Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([59.436962, 24.753574], 13); // Tallinn center

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const layerControl = L.control.layers(null, null, { collapsed: false }).addTo(map);

        const sources = [
            { name: 'Tallinn', url: '/data/tallinn.json', color: 'orange' },
            { name: 'EuroPark', url: '/data/europark.json', color: 'blue' },
            { name: 'Parkimine.ee', url: '/data/parkimine-ee.json', color: 'green' },
            { name: 'Snabb', url: '/data/snabb.json', color: 'red' },
        ];

        sources.forEach(source => {
            fetch(source.url)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    const layerGroup = L.layerGroup();
                    
                    data.forEach(item => {
                        let polygonsPoints = [];
                        
                        if (item.regions) {
                            // Check for EuroPark style (regions is array of coords: [[lat,lon], [lat,lon], ...])
                            // item.regions[0] is [lat, lon], so item.regions[0][0] is number
                            if (Array.isArray(item.regions) && item.regions.length > 0 && Array.isArray(item.regions[0]) && typeof item.regions[0][0] === 'number') {
                                polygonsPoints.push(item.regions);
                            } 
                            // Check for Others style (regions is array of objects with points)
                            else if (Array.isArray(item.regions)) {
                                item.regions.forEach(r => {
                                    if (r.points) {
                                        let regionParts = [r.points];
                                        if (r.interiorRegions && Array.isArray(r.interiorRegions)) {
                                            r.interiorRegions.forEach(ir => {
                                                if (ir.points) {
                                                    regionParts.push(ir.points);
                                                }
                                            });
                                        }
                                        polygonsPoints.push(regionParts);
                                    } else if (Array.isArray(r) && r.length > 0 && Array.isArray(r[0]) && typeof r[0][0] === 'number') {
                                        // Case where regions might be array of polygons directly
                                        polygonsPoints.push(r);
                                    }
                                });
                            }
                        }

                        polygonsPoints.forEach(points => {
                             L.polygon(points, { color: source.color, weight: 2, fillOpacity: 0.2 })
                                 .bindPopup(`<b>${source.name}</b><br>Code: ${item.code || 'N/A'}<br>Provider: ${item.provider || 'N/A'}`)
                                 .addTo(layerGroup);
                        });
                    });

                    layerGroup.addTo(map);
                    layerControl.addOverlay(layerGroup, source.name);
                })
                .catch(err => console.error(`Error loading ${source.name}:`, err));
        });
    </script>
</body>
</html>
